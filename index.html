<!DOCTYPE html>

<!-- If the game is too fast or too slow for you, just change the gameSpeed variable at the beginning of the <script> tag -->


<!--
    Precursor Released on: April 30th 2017
    Last Updated: March 18th 2022
    Latest Update: Adding new skins.
    Reason I made this: I had just designed an HTML menu similar to this that I liked, And I felt like making a game, And a dodge game didn't seem too hard.

    Tested in Firefox, Safari, and Chrome
-->

<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="apple-touch-icon-precomposed" href="apple-touch-favicon.png">
        <link rel="icon" href="favicon.ico">
        <title>Dodge 'n Collect</title>

        <style>
            html, body {
                overflow: hidden;
            }
        </style>
    </head>

    <body>
        <audio loop id="mainTheme" src="mainTheme.mp3">
        </audio>
        <audio id="ding" src="ding.mp3">
        </audio>
        <audio id="levelOrRoundFinished" src="levelOrRoundFinished.mp3"></audio>

        <canvas id="canvas" width="550" height="550"></canvas>
        <script>
            // Settings for sound/music
            var soundsOn = false;
            var musicOn = false;

            if(localStorage.getItem("soundsOn") === null || localStorage.getItem("soundsOn") === undefined) {
                localStorage.setItem("soundsOn", "false");
            } else if (localStorage.getItem("soundsOn") === "true") {
                soundsOn = true;
            }
            if(localStorage.getItem("musicOn") === null || localStorage.getItem("musicOn") === undefined) {
                localStorage.setItem("musicOn", "false");
            } else if (localStorage.getItem("musicOn") === "true") {
                musicOn = true;
            };

            function startMainTheme() {
                if(musicOn === true) {
                    document.getElementById("mainTheme").play();
                }
            };
            function stopMainTheme() {
                if(musicOn === true) {
                    document.getElementById("mainTheme").load();
                }
            }
            // Setting Up Canvas with Javascript
            {

                var canvas = document.getElementById("canvas");
                canvas.height = window.innerHeight;
                canvas.width = window.innerWidth;
                var ctx = canvas.getContext("2d");
                var width = canvas.getAttribute("width");
                var height = canvas.getAttribute("height");
                var setBackgroundColor = function(color) {
                    var fillStyle = ctx.fillStyle;
                    ctx.fillStyle = color;
                    ctx.fillRect(0, 0, width, height);
                    ctx.fillStyle = fillStyle;
                };

                CanvasRenderingContext2D.prototype.roundRect = function (x, y, w, h, r) {
                    if (w < 2 * r) r = w / 2;
                    if (h < 2 * r) r = h / 2;
                    this.beginPath();
                    this.moveTo(x+r, y);
                    this.arcTo(x+w, y,   x+w, y+h, r);
                    this.arcTo(x+w, y+h, x,   y+h, r);
                    this.arcTo(x,   y+h, x,   y,   r);
                    this.arcTo(x,   y,   x+w, y,   r);
                    this.closePath();
                    return this;
                };

                var rangedRandom = function(low, high) {
                    return Math.random() * (high - low) + low;
                };

                var circle = function(x, y, radius, fill) {
                    ctx.beginPath();
                    ctx.arc(x, y, radius, 0, Math.PI * 2);
                    if(fill) ctx.fill();
                    else ctx.stroke();
                    ctx.closePath();
                };


                var color = function(r, g, b, a) {
                    if(a === undefined) {
                        return "rgb(" + r + "," + g + "," + b + ")";
                    }
                    else {
                        return "rgba(" + r + "," + g + "," + b + "," + a + ")";
                    }
                };
                var Vector = function(xpos, ypos, xMoveRate, yMoveRate) {
                    this.x = xpos;
                    this.y = ypos;
                    this.xMoveRate = xMoveRate;
                    this.yMoveRate = yMoveRate;
                };


                // Key Game Variables
                var initialNumberOfBlocks = Math.round((canvas.width + canvas.height / 2) / 250);  // The inital number of blocks

                var numberOfBlocks = initialNumberOfBlocks; //This sets the maximum number of blocks that can be around at the same time (More is harder)

                var darkMode = false; // Activates and deactivates dark mode
                var numberOfStars = 12;



            };

            // Code to detect if the mouse is down or up
            var mouseIsDown = false;

            // Set of useful functions
            var Button = function(x, y, txt, color, txtcolor, buttonHeight, buttonWidth, isSkinButton) {
                // code to check if button is skin button due to previous faulty mouse-button collision detection
                if(isSkinButton === true) {
                    this.isSkinButton = true;
                } else if(isSkinButton === false || isSkinButton === undefined) {
                    this.isSkinButton = false;
                };


                this.x = x;
                this.y = y;
                this.txt = txt;
                this.color = color;
                this.txtcolor = txtcolor;
                if(buttonWidth === undefined) {
                    this.width = txt.length * 10;
                } else {
                    this.width = buttonWidth;
                };
                if(buttonHeight === undefined) {
                    this.height = 41;
                } else {
                    this.height = buttonHeight;
                };

                this.draw = function() {
                    ctx.save();
                    ctx.textAlign = "center";
                    ctx.fillStyle = this.color;
                    ctx.roundRect(this.x-this.width+(this.txt.length*5), this.y-this.height, this.width, this.height, 5).fill();
                    ctx.font = "20px cursive";
                    ctx.fillStyle = this.txtcolor;
                    ctx.fillText(this.txt, this.x-(this.width/2)+(this.txt.length*5), this.y-(this.height/2));
                    ctx.restore();
                };
                this.mouseIsInside = function(event) {
                    if(this.isSkinButton === false) {
                        if(event.clientX >= (this.x-(this.width/2)) && event.clientX <= (this.x-(this.width/2) + this.width) && event.clientY >= (this.y-this.height) && event.clientY <= this.y) {
                        return true;
                    } else {
                        return false;
                    };
                    } else if(this.isSkinButton === true) {
                        if(event.clientX >= (this.x-(this.width)) && event.clientX <= (this.x-(this.width) + this.width) && event.clientY >= (this.y-this.height) && event.clientY <= this.y) {
                        return true;
                    };
                    };


                    return false;
                };
            };

            var createLevelButton = function(number, x, y) {
                return new Button(x, y, number, "blue", "orange", 35, 35);
            };


            var playButton = new Button(width/2, height/2 - 110, "  Play  ", "blue", "orange");
            var howButton = new Button(width/2, height/2 + 90, "   How  ", "blue", "orange");
            var levelsButton = new Button(width/2, height/2 - 10, "  Levels  ", "blue", "orange");
            var gameControlsButton = new Button(width/2, height/2 + 190 , " Game Controls ", "blue", "orange");
            var backButton = new Button(60, height-50, "  Back  ", "blue", "orange");
            var retryButton = new Button(60, height-125, "  Retry  ", "blue", "orange");
            var backButtonFromLoseScreen = new Button(60, height-50, "  Back  ", "blue", "orange");
            var nextButton = new Button(60, height - 200, "  Next  ", "blue", "orange");
            var numberOfBlocksButton = new Button(width/2, height/2 + 100, "  Number Of Blocks  ", "blue", "orange");
            var soundsButton = new Button(width/2, height/2 - 100, "  Sounds : Off  ", "blue", "orange");
            if(soundsOn === true) {
                soundsButton.txt = "  Sounds : On  ";
            }
            var musicButton = new Button(width/2, height/2, "  Music : Off  ", "blue", "orange");
            if(musicOn === true) {
                musicButton.txt = "  Music : On  ";
            };
            var skinsButtonsWidthHeight = height/6;
            if(skinsButtonsWidthHeight > width/6) {
              skinsButtonsWidthHeight = width/6;
            };
            var skinsButton = new Button(width/2, height/2 + 100, "  Skins  ", "blue", "orange");
            var blueSkin = new Button(width/2, skinsButtonsWidthHeight + 20, "", "blue", "blue", skinsButtonsWidthHeight, skinsButtonsWidthHeight, true);
            var greenSkin = new Button(width/2 - (width/4), skinsButtonsWidthHeight * 2.5 + 20, "", color(0, 255, 0), "green", skinsButtonsWidthHeight, skinsButtonsWidthHeight, true);
            var purpleSkin = new Button(width/2, skinsButtonsWidthHeight * 2.5 + 20, "", color(111, 0, 255), "purple", skinsButtonsWidthHeight, skinsButtonsWidthHeight, true);
            var orangeSkin = new Button(width/2 + (width/4), skinsButtonsWidthHeight * 2.5 + 20, "", color(184, 120, 0), "orange", skinsButtonsWidthHeight, skinsButtonsWidthHeight, true);
            var pinkSkin = new Button(width/2 - (width/4), skinsButtonsWidthHeight * 3.75 + 40, "", color(255, 166, 201), "pink", skinsButtonsWidthHeight, skinsButtonsWidthHeight, true);
            var whiteSkin = new Button(width/2, skinsButtonsWidthHeight * 3.75 + 40, "", color(255, 255, 255), "white", skinsButtonsWidthHeight, skinsButtonsWidthHeight, true);


            var Coin = function(x, y, r) {
                this.x = x;
                this.y = y;
                this.r = r;
                this.draw = function() {
                    ctx.save();
                    ctx.fillStyle = "orange";
                    circle(this.x, this.y, this.r, true);
                    ctx.restore();
                };
            };

            var coin = new Coin(rangedRandom(20, width - 20), rangedRandom(40, height - 20), 10);
            var moveCoin = function() {
                score += 1;
                coin.x = rangedRandom(20, width - 20);
                coin.y = rangedRandom(40, height - 20);
                if(soundsOn === true) {
                    document.getElementById("ding").play();
                };
            };


            var redBlockXMoveRate = {
                    min: -5,
                    max: 5,
            };
            var redBlockYMoveRate = {
                min: -5,
                max: 5,
            };
            var redBlocks = [];
            for(var i = 0; i < numberOfBlocks; i++) {
                redBlocks.push(new Vector(width/2, height/2, rangedRandom(redBlockXMoveRate.min, redBlockXMoveRate.max), rangedRandom(redBlockYMoveRate.min, redBlockYMoveRate.max)));
            };

            var stars = [];
            for(var i = 0; i < numberOfStars; i++) {
                stars.push(new Vector(rangedRandom(0, width), height, rangedRandom(redBlockXMoveRate.min, redBlockXMoveRate.max), rangedRandom(redBlockYMoveRate.min, redBlockYMoveRate.max)));
            };

            var levelButtons = [
                createLevelButton("1", width/2 - 70, height/2 - 70),
                createLevelButton("2", width/2, height/2 - 70),
                createLevelButton("3", width/2 + 70, height/2 - 70),
                createLevelButton("4", width/2 - 70, height/2),
                createLevelButton("5", width/2, height/2),
                createLevelButton("6", width/2 + 70, height/2),
                createLevelButton("7", width/2 - 70, height/2 + 70),
                createLevelButton("8", width/2, height/2 + 70),
                createLevelButton("9", width/2 + 70, height/2 + 70)
            ];

            var level = 0;

            var MakeLevel = function(levelNum, maxBlockSpeed, nBlocks, coinGoal) {
                this.maxBlockSpeed = maxBlockSpeed;
                this.nBlocks = nBlocks;
                this.coinGoal = coinGoal;
            };

            var levels = [
                new MakeLevel(1, 0.5, 0.5, 5),
                new MakeLevel(2, 1, 1, 15),
                new MakeLevel(3, 1.25, 1.25, 30),
                new MakeLevel(4, 1.25, 1.25, 50),
                new MakeLevel(5, 1.5, 1.5, 45),
                new MakeLevel(6, 1.5, 2, 40),
                new MakeLevel(7, 2.5, 1.25, 30),
                new MakeLevel(8, 3, 1, 50),
                new MakeLevel(9, 1, 3, 50),
            ];

            var changeLevel = function(newLevel) {
                seconds = 0;
                level = newLevel;
                redBlockXMoveRate.min = -(levels[level - 1].maxBlockSpeed * 5);
                redBlockXMoveRate.max = levels[level - 1].maxBlockSpeed * 5;
                redBlockYMoveRate.min = -(levels[level - 1].maxBlockSpeed * 5);
                redBlockYMoveRate.max = levels[level - 1].maxBlockSpeed * 5;
                console.log(Math.round(initialNumberOfBlocks * levels[level - 1].nBlocks));
                numberOfBlocks = Math.round(initialNumberOfBlocks * levels[level - 1].nBlocks);
                player.x = width/2;
                player.y = height - 40;

                redBlocks = [];
                for(var i = 0; i < numberOfBlocks; i++) {
                    redBlocks.push(new Vector(width/2, height/2, rangedRandom(redBlockXMoveRate.min, redBlockXMoveRate.max), rangedRandom(redBlockYMoveRate.min, redBlockYMoveRate.max)));
                };

                score = 0;
                scene = "play";
            };



            var levelsCompleted = [];
            var tempLevelsCompleted = localStorage.getItem("levelsCompleted");
            if(tempLevelsCompleted === null || tempLevelsCompleted === undefined) {
                for(i = 0; i < 9; i++) {
                    levelsCompleted.push(false);
                };
                localStorage.setItem("levelsCompleted", levelsCompleted.toString());

            } else {
                levelsCompleted = tempLevelsCompleted.split(",");
                for(i = 0; i < levelsCompleted.length; i++) {
                    if(levelsCompleted[i] === "true") {
                        levelsCompleted[i] = true;
                    } else if(levelsCompleted[i] === "false") {
                        levelsCompleted[i] = false;
                    };
                };
            };

            var highScore = 0;
            var tempHighScore = localStorage.getItem("highScore");
            if(tempHighScore === null || tempHighScore === undefined) {
                localStorage.setItem("highScore", "0");
            } else {
                highScore = Number(tempHighScore);
            };
            var now = new Date().getTime();
            var score = 0;
            var keysPressed = [];
            var skin = "blue";

            var mercobaCharacter = new Image();
            mercobaCharacter.src = "MercobaCharacter.png";

            var player = {
                x: width/2,
                y: height - 40,
                draw: function() {
                    ctx.save();
                    if (skin === "blue"){
                        ctx.fillStyle = blueSkin.color;
                    } else if (skin === "green"){
                        ctx.fillStyle = greenSkin.color;
                    } else if (skin === "purple") {
                        ctx.fillStyle = purpleSkin.color;
                    } else if(skin === "orange") {
                        ctx.fillStyle = orangeSkin.color;
                    } else if(skin === "pink") {
                      ctx.fillStyle = pinkSkin.color;
                    } else if(skin === "white") {
                      ctx.fillStyle = whiteSkin.color;
                    }
                    if (skin === "mercoba") {
                        ctx.drawImage(mercobaCharacter, this.x-40, this.y, 40, 40);
                    } else {
                        ctx.fillRect(this.x-40, this.y, 40, 40);
                    };

                    ctx.restore();
                },
            };

            var dodgencollecticon = new Image();
            dodgencollecticon.src = "dodgencollecticon.png"

            var backgroundImage = new Image();
            backgroundImage.src = "StarsExperimentWithPlanet.png";

            var backgroundImageWithoutPlanet = new Image();
            backgroundImageWithoutPlanet.src = "StarsExperiment.png";

            var checkmarkIcon = new Image();
            checkmarkIcon.src = "Checkmarkicon.png";
            // Scenes
            var logoProgress = 0;
            var seconds = 0;
            var pause = false;
            var scene = "logo";

            var scenes = {
                logo: function() {

                    ctx.save();
                    setBackgroundColor(0, 0, 0);
                    ctx.font = "40px serif";
                    ctx.textAlign = "center";
                    ctx.fillStyle = color(255, 0, 255);
                    ctx.fillText("MasterCat3", width/2, height/2);
                    ctx.fillText("Presents...", width/2, height/2+50);
                    logoProgress++;
                    if(logoProgress > 120) {
                        scene = "menu";
                    };
                    ctx.restore();
                },
                menu: function() {
                    setBackgroundColor(color(102, 0, 255));
                    try {
                        ctx.drawImage(backgroundImage, 0, 0, width, height);
                    } catch(err) {
                        console.log(err.message);
                    };
                    ctx.save();
                    ctx.fillStyle = "white";
                    ctx.textAlign = "center";
                    if(width < 320 || height < 447) {
                        ctx.font = "15px cursive";
                        var titleTextX = 20;
                    } else {
                        ctx.font = "30px cursive";
                        var titleTextX = 50;
                    };
                    ctx.drawImage(dodgencollecticon, width/2 - 150, titleTextX - titleTextX/2, 50, 50);
                    ctx.fillText("Dodge 'n Collect", width/2, titleTextX);
                    ctx.fillText("High Score : " + highScore.toString(), width/2, titleTextX + 75);
                    ctx.save();
                    playButton.draw();
                    howButton.draw();
                    gameControlsButton.draw();
                    levelsButton.draw();
                    ctx.restore();
                },
                play: function() {
                    if(pause === false) {
                        if (new Date().getTime() - now >= 1000) {
                            seconds += 1;
                            now = new Date().getTime();
                        };
                    };
                    ctx.save();
                    if(darkMode === true) {
                        setBackgroundColor(color(0, 0, 0));
                    } else {
                        setBackgroundColor(color(255, 255, 255));
                    };
                    try {
                       ctx.drawImage(backgroundImageWithoutPlanet, 0, 0, width, height);
                    } catch(err) {
                        console.log(err.message);
                    };

                    coin.draw();

                    for(var i = 0; i < redBlocks.length; i++) {
                        ctx.save();
                        ctx.fillStyle = "red";

                        if(pause === false) {
                            redBlocks[i].x += redBlocks[i].xMoveRate;
                            redBlocks[i].y += redBlocks[i].yMoveRate;
                        };

                        // Handling red block collisions with the wall and adjusting the x/y move rate
                        if(redBlocks[i].y >= height) {
                            redBlocks[i].yMoveRate = rangedRandom(redBlockYMoveRate.min, 0);
                        } else if(redBlocks[i].y <= 80) {
                            redBlocks[i].yMoveRate = rangedRandom(0, redBlockYMoveRate.max);
                        };
                        if(redBlocks[i].x >= width) {
                            redBlocks[i].xMoveRate = rangedRandom(redBlockXMoveRate.min, 0);
                        } else if(redBlocks[i].x <= 40) {
                            redBlocks[i].xMoveRate = rangedRandom(0, redBlockXMoveRate.max);
                        };


                        if(level != 0) {
                            if(score === levels[level - 1].coinGoal) {
                                scene = "lose";
                                stopMainTheme();
                                if(soundsOn === true) {
                                    document.getElementById("levelOrRoundFinished").play();
                                };
                            };
                        };


                        if(redBlocks[i].x >= player.x-40 && redBlocks[i].x <= player.x+40 && redBlocks[i].y >= player.y && redBlocks[i].y <= player.y + 80) {
                            scene = "lose";
                            stopMainTheme();
                            if(soundsOn === true) {
                                document.getElementById("levelOrRoundFinished").play();
                            };
                        };

                        ctx.fillRect(redBlocks[i].x-40, redBlocks[i].y-40, 40, 40);

                        // Handling player and coin collisions
                        var distX = Math.abs(coin.x - player.x-(40/2-40));
                        var distY = Math.abs(coin.y - player.y-40/2);
                        var dx=distX-40/2;
                        var dy=distY-(40/2);

                        if (distX > (40/2 + coin.r)) {}
                        if (distY > ((40/2-40) + coin.r)) {}

                        if (distX <= (40/2) && distY <= (40/2) || dx*dx+dy*dy<=(coin.r*coin.r)) { moveCoin();}
                        ctx.restore();
                    };

                    for(var i = 0; i < stars.length; i++) {
                        // Handling stars collisions with the wall and adjusting the x/y move rate
                        stars[i].x += stars[i].xMoveRate;
                        stars[i].y += stars[i].yMoveRate;

                        if(stars[i].x >= width) {
                            stars[i].x = rangedRandom(0, width)
                            stars[i].xMoveRate = rangedRandom(redBlockXMoveRate.min, 0);
                        } else if(stars[i].x <= 40) {
                            stars[i].x = rangedRandom(0, width)
                            stars[i].xMoveRate = rangedRandom(0, redBlockXMoveRate.max);
                        };

                        if(stars[i].y >= height) {
                            stars[i].y = rangedRandom(0, height);
                            stars[i].yMoveRate = rangedRandom(redBlockYMoveRate.min, 0);
                        } else if(stars[i].y <= 40) {
                            stars[i].y = rangedRandom(0, height);
                            stars[i].yMoveRate = rangedRandom(0, redBlockYMoveRate.max);
                        };
                        ctx.fillStyle = "white";
                        circle(stars[i].x-40, stars[i].y-40, 3, true);

                    };

                    if(pause === false) {
                        if(keysPressed[37] || keysPressed[65]) {
                            if(player.x > 40) {
                                player.x -= 7;
                            };
                        };
                        if(keysPressed[39] || keysPressed[68]) {
                            if(player.x < width - 13) {
                                player.x += 7;
                            };
                        };
                        if(keysPressed[38] || keysPressed[87]) {
                            if(player.y > 40) {
                                player.y -= 7;
                            };
                        };
                        if(keysPressed[40] || keysPressed[83]) {
                            if(player.y < height - 47) {
                                player.y += 7;
                            };
                        };
                    };
                    ctx.fillStyle = color(130,130,180, 0.5);
                    ctx.fillRect(0, 0, width, 40);
                    ctx.textAlign = "center";
                    ctx.fillStyle = "white";
                    var textSize = canvas.width / 100 * 4;
                    if(textSize > 30) {textSize = 30};
                    ctx.font = textSize + "px cursive";
                    var scoreSecondsTxt = "";
                    if(level === 0) {
                      scoreSecondsTxt = "Score: " + Math.round(score) + "     Seconds: " + seconds;
                        ctx.fillText(scoreSecondsTxt, width/2, textSize);
                    } else {
                        scoreSecondsTxt = "Score: " + Math.round(score) + " / " + levels[level - 1].coinGoal + "     Seconds: " + seconds;
                        ctx.fillText(scoreSecondsTxt, width/2, textSize);
                    }
                    ctx.drawImage(dodgencollecticon, width/2 - (textSize * (scoreSecondsTxt.length / 2)), 0, 40, 40);

                    ctx.save();

                    player.draw();
                    ctx.restore();
                },
                how: function() {
                    ctx.save();
                    setBackgroundColor(color(0, 0, 0));
                    try {
                       ctx.drawImage(backgroundImageWithoutPlanet, 0, 0, width, height);
                    } catch(err) {
                        console.log(err.message);
                    };

                    ctx.textAlign = "center";
                    var fontSize = canvas.width / 100 * 4;
                    if(fontSize >= 50) {fontSize = 50};
                    ctx.font = fontSize + "px cursive";
                    ctx.fillStyle = "white";
                    ctx.fillText("You are the blue block. Move", width/2, height/2 - (fontSize * 2.5));
                    ctx.fillText("around with the arrow keys", width/2, height/2 - (fontSize * 1.25));
                    ctx.fillText("or drag your mouse or finger", width/2, height/2);
                    ctx.fillText("and dodge the red blocks", width/2, height/2+fontSize*1.25);
                    ctx.fillText("and collect the yellow coins.", width/2, height/2+fontSize*2.5);
                    ctx.save();
                    backButton.draw();
                    ctx.restore();
                },
                lose: function() {
                    ctx.textAlign = "center";
                    setBackgroundColor(color(0, 0, 0));
                    try {
                       ctx.drawImage(backgroundImageWithoutPlanet, 0, 0, width, height);
                    } catch(err) {
                        console.log(err.message);
                    };
                    ctx.save();
                    if(score > highScore && level === 0) {
                        highScore = score;
                        localStorage.setItem("highScore", highScore.toString());
                    };
                    var fontSize = canvas.width / 100 * 4;
                    if(fontSize >= 50) {fontSize = 50};
                    ctx.font = fontSize + "px cursive";
                    ctx.fillStyle = "white";
                    ctx.save();
                    ctx.translate(0, -150);
                    ctx.fillText("Congratulations!", width/2, height/2);
                    if(score === 1){
                        ctx.fillText("You got " + score + " point in " + seconds + " seconds!", width/2, height/2 + (fontSize * 1.25));
                    } else {
                        ctx.fillText("You got " + score + " points in " + seconds + " seconds!", width/2, height/2 + (fontSize * 1.25));
                    };

                    if(level === 0) {
                        ctx.fillText("Click the retry button to play again.", width/2, height/2+fontSize*2.5);
                    } else {
                        if(score >= levels[level - 1].coinGoal) {
                            ctx.fillText("You passed level " + level + "!", width/2, height/2+fontSize*2.5);
                            ctx.fillText("Click the retry button to play again.", width/2, height/2+fontSize*3.75);
                            levelsCompleted[level - 1] = true;
                            localStorage.setItem("levelsCompleted", levelsCompleted.toString());
                            console.log(localStorage.getItem("levelsCompleted"))
                        } else {
                            ctx.fillText("You failed level " + level + ".", width/2, height/2+fontSize*2.5);
                            ctx.fillText("Click the retry button to play again.", width/2, height/2+fontSize*3.75);
                        };
                    };

                    ctx.restore();
                    retryButton.draw();
                    backButtonFromLoseScreen.draw();
                    if(level != 0 && level < 9 && score >= levels[level - 1].coinGoal) {
                        nextButton.draw();
                    };
                    ctx.restore();
                    if(keysPressed[82]) {
                        score = 0;
                        seconds = 0;
                        player.x = width/2;
                        player.y = height - 40;
                        for(var i = 0; i < redBlocks.length; i++) {
                            redBlocks[i].x = width/2;
                            redBlocks[i].y = height/2;
                            redBlocks[i].xMoveRate = rangedRandom(redBlockXMoveRate.min, redBlockXMoveRate.max);
                            redBlocks[i].yMoveRate = rangedRandom(redBlockYMoveRate.min, redBlockYMoveRate.max);
                        };
                        scene = "play";
                    };
                },
                gameControls: function() {
                    ctx.fillStyle = "blue"; ctx.font = "30px sans-serif"; ctx.fillText(numberOfBlocks, 100, 100);
                    ctx.save();
                    setBackgroundColor(color(0,0,0));
                    try {
                        ctx.drawImage(backgroundImage, 0, 0, width, height);
                    } catch(err) {
                        console.log(err.message);
                    };
                    backButton.draw();
                    soundsButton.draw();
                    musicButton.draw();
                    skinsButton.draw();
                    ctx.restore();

                },
                levels: function() {
                    setBackgroundColor(color(0, 0, 0));
                    try {
                       ctx.drawImage(backgroundImageWithoutPlanet, 0, 0, width, height);
                    } catch(err) {
                        console.log(err.message);
                    };

                    for(i = 0; i < levelButtons.length; i++) {
                        levelButtons[i].draw();
                    };

                    for(i = 0; i < levelsCompleted.length; i++) {
                        if(levelsCompleted[i] === true) {
                            ctx.drawImage(checkmarkIcon, levelButtons[i].x - 10, levelButtons[i].y - 5, 20, 20);
                        }
                    }
                    backButton.draw();
                },
                skins: function() {
                    setBackgroundColor(color(0, 255, 0));
                    try {
                       ctx.drawImage(backgroundImageWithoutPlanet, 0, 0, width, height);
                    } catch(err) {
                        console.log(err.message);
                    };

                    backButton.draw();
                    blueSkin.draw();
                    greenSkin.draw();
                    purpleSkin.draw();
                    orangeSkin.draw();
                    pinkSkin.draw();
                    whiteSkin.draw();
                    mercobaCharacterX = width/2 + (width/4) - skinsButtonsWidthHeight;
                    mercobaCharacterY = skinsButtonsWidthHeight * 3.75 + 40 - skinsButtonsWidthHeight;
                    ctx.drawImage(mercobaCharacter, width/2 + (width/4) - skinsButtonsWidthHeight, skinsButtonsWidthHeight * 3.75 + 40 - skinsButtonsWidthHeight, skinsButtonsWidthHeight, skinsButtonsWidthHeight);

                    if(skin === "blue") {
                        ctx.strokeStyle = "yellow";
                        ctx.lineWidth = height/50;
                        ctx.roundRect(blueSkin.x-blueSkin.width, blueSkin.y-blueSkin.height, blueSkin.width, blueSkin.height, 5).stroke();
                        ctx.closePath();
                    } else if (skin === "green") {
                        ctx.strokeStyle = "yellow";
                        ctx.lineWidth = height/50;
                        ctx.roundRect(greenSkin.x-greenSkin.width, greenSkin.y-greenSkin.height, greenSkin.width, greenSkin.height, 5).stroke();
                        ctx.closePath();
                    } else if (skin === "purple") {
                        ctx.strokeStyle = "yellow";
                        ctx.lineWidth = height/50;
                        ctx.roundRect(purpleSkin.x-purpleSkin.width, purpleSkin.y-purpleSkin.height, purpleSkin.width, purpleSkin.height, 5).stroke();
                        ctx.closePath();
                    } else if (skin === "orange") {
                        ctx.strokeStyle = "yellow";
                        ctx.lineWidth = height/50;
                        ctx.roundRect(orangeSkin.x-orangeSkin.width, orangeSkin.y-orangeSkin.height, orangeSkin.width, orangeSkin.height, 5).stroke();
                        ctx.closePath();
                    } else if (skin === "pink") {
                      ctx.strokeStyle = "yellow";
                      ctx.lineWidth = height/50;
                      ctx.roundRect(pinkSkin.x-pinkSkin.width, pinkSkin.y-pinkSkin.height, pinkSkin.width, pinkSkin.height, 5).stroke();
                      ctx.closePath();
                    } else if (skin === "white") {
                      ctx.strokeStyle = "yellow";
                      ctx.lineWidth = height/50;
                      ctx.roundRect(whiteSkin.x-whiteSkin.width, whiteSkin.y-whiteSkin.height, whiteSkin.width, whiteSkin.height, 5).stroke();
                      ctx.closePath();
                    } else if (skin === "mercoba") {
                      console.log("Hey there")
                      ctx.strokeStyle = "yellow";
                      ctx.lineWidth = height/50;
                      ctx.roundRect(mercobaCharacterX, mercobaCharacterY, skinsButtonsWidthHeight, skinsButtonsWidthHeight, 4).stroke();
                      ctx.closePath();
                    }

                }
            };

            // Code to be run 60 times per seconds(Or as many FPS as the device allows)
            var draw = function() {
                scenes[scene]();
                requestAnimationFrame(draw);
            };
            requestAnimationFrame(draw);


            //Handling Mouse controls
            canvas.addEventListener("mousedown", function(event) {
                mouseIsDown = true;
                if(scene === "play" && pause === false) {
                    player.x = event.clientX;
                    if(event.clientY >= 60) {
                        player.y = event.clientY - 20;
                    } else {
                        player.y = 40;
                    }
                };
            });
            canvas.addEventListener("mouseup", function() {
                mouseIsDown = false;
            });
            canvas.addEventListener("mousemove", function(event) {
                if(mouseIsDown && scene === "play" && pause === false) {
                    player.x = event.clientX;
                    if(event.clientY >= 60) {
                      player.y = event.clientY - 20;
                    } else {
                      player.y = 40;
                    }
                };
                if(scene === "menu") {
                    if(playButton.mouseIsInside(event)) {
                        playButton.color = color(0, 120, 255);
                    } else if(!playButton.mouseIsInside(event)) {
                        playButton.color = color(0, 0, 255)
                    };
                    if (levelsButton.mouseIsInside(event)) {
                        levelsButton.color = color(0, 120, 255);
                    } else if (!levelsButton.mouseIsInside(event)) {
                        levelsButton.color = color(0, 0, 255);
                    };
                    if(howButton.mouseIsInside(event)) {
                        howButton.color = color(0, 120, 255);
                    } else if(!howButton.mouseIsInside(event)) {
                        howButton.color = color(0, 0, 255);
                    };
                    if(gameControlsButton.mouseIsInside(event)) {
                        gameControlsButton.color = color(0, 120, 255);
                    } else if(!gameControlsButton.mouseIsInside(event)) {
                        gameControlsButton.color = color(0, 0, 255);
                    };
                };
                if(scene === "gameControls" || scene === "how" || scene === "levels" || scene === "skins") {
                    if(backButton.mouseIsInside(event)) {
                        backButton.color = color(0, 120, 255);
                    } else if(!backButton.mouseIsInside(event)) {
                        backButton.color = color(0, 0, 255);
                    };
                };
                if(scene === "lose") {
                    if(retryButton.mouseIsInside(event)) {
                        retryButton.color = color(0, 120, 255);
                    } else if(!retryButton.mouseIsInside(event)) {
                        retryButton.color = color(0, 0, 255);
                    };
                    if(backButtonFromLoseScreen.mouseIsInside(event)) {
                        backButtonFromLoseScreen.color = color(0, 120, 255);
                    } else if(!backButtonFromLoseScreen.mouseIsInside(event)) {
                        backButtonFromLoseScreen.color = color(0, 0, 255);
                    };
                    if(nextButton.mouseIsInside(event)) {
                        nextButton.color = color(0, 120, 255);
                    } else if (!nextButton.mouseIsInside(event)) {
                        nextButton.color = color(0, 0, 255);
                    };
                };
                if(scene === "levels") {
                    for(i = 0; i < levelButtons.length; i++) {
                        if(levelButtons[i].mouseIsInside(event)) {
                            levelButtons[i].color = color(0, 120, 255);
                        } else if(!levelButtons[i].mouseIsInside(event)) {
                            levelButtons[i].color = color(0, 0, 255);
                        };
                    }
                }
                if(scene === "gameControls") {
                    if(soundsButton.mouseIsInside(event)) {
                        soundsButton.color = color(0, 120, 255);
                    } else if(!soundsButton.mouseIsInside(event)) {
                        soundsButton.color = color(0, 0, 255);
                    };
                    if(musicButton.mouseIsInside(event)) {
                        musicButton.color = color(0, 120, 255);
                    } else if(!musicButton.mouseIsInside(event)) {
                        musicButton.color = color(0, 0, 255);
                    }
                    if (skinsButton.mouseIsInside(event)) {
                        skinsButton.color = color(0, 120, 255);
                    } else if(!skinsButton.mouseIsInside(event)) {
                        skinsButton.color = color(0, 0, 255);
                    };
                };
                if (scene === "skins") {
                    if(blueSkin.mouseIsInside(event)) {
                        blueSkin.color = color(0, 120, 255);
                    } else if(!blueSkin.mouseIsInside(event)) {
                        blueSkin.color = color(0, 0, 255);
                    };
                    if(greenSkin.mouseIsInside(event)) {
                        greenSkin.color = color(120, 255, 150);
                    } else if(!greenSkin.mouseIsInside(event)) {
                        greenSkin.color = color(0, 255, 0);
                    };
                    if(purpleSkin.mouseIsInside(event)) {
                        purpleSkin.color = color(135, 0, 255);
                    } else if(!purpleSkin.mouseIsInside(event)) {
                        purpleSkin.color = color(111, 0, 255);
                    };
                    if(orangeSkin.mouseIsInside(event)) {
                      orangeSkin.color = color(225, 147, 5);
                    } else if(!orangeSkin.mouseIsInside(event)) {
                      orangeSkin.color = color(184, 120, 0);
                    };
                    if(pinkSkin.mouseIsInside(event)) {
                      pinkSkin.color = color(255, 166, 201);
                    } else if(!pinkSkin.mouseIsInside(event)) {
                      pinkSkin.color = color(255, 166, 255);
                    };
                    if(whiteSkin.mouseIsInside(event)) {
                      whiteSkin.color = color(233, 233, 233);
                    } else if(!whiteSkin.mouseIsInside(event)) {
                      whiteSkin.color = color(255, 255, 255);
                    }

                };
            });


            var touches = null;
            //Handling Touch Events
            canvas.addEventListener("touchstart", function(event) {
                touches = event.changedTouches;
                if (scene === "play") {
                    if(touches[0].clientX >= 20 && touches[0].clientX < width && touches[0].clientY > 40 && touches[0].clientY < height - 20 && pause === false) {
                        player.x = touches[0].clientX;
                        player.y = touches[0].clientY - 20;
                    };
                    event.preventDefault();
                };
            });
            canvas.addEventListener("touchmove", function(event) {
                touches = event.changedTouches;
                if (scene === "play") {
                    if(touches[0].clientX >= 20 && touches[0].clientX < width && touches[0].clientY > 40 && touches[0].clientY < height - 20 && pause === false) {
                        player.x = touches[0].clientX;
                        player.y = touches[0].clientY - 20;
                    };
                    event.preventDefault();
                };
            });


            // Handing button collisions
            canvas.addEventListener("click", function(event) {
                    if(scene === "menu") {
                        if(playButton.mouseIsInside(event)) {
                            scene = "play";
                            startMainTheme();
                            player.x = width/2;
                            player.y = height - 40;
                            seconds = 0;
                            score = 0;
                            numberOfBlocks = initialNumberOfBlocks;
                            playButton.color = color(0, 0, 255);

                        } else if(howButton.mouseIsInside(event)) {
                            scene = "how";
                            howButton.color = color(0, 0, 255);
                        } else if(gameControlsButton.mouseIsInside(event)) {
                            scene = "gameControls";
                            gameControlsButton.color = color(0, 0, 255);
                        } else if(levelsButton.mouseIsInside(event)) {
                            scene = "levels";
                            levelsButton.color = color(0, 0, 255);
                        };
                    } else if(scene === "how") {
                        if(backButton.mouseIsInside(event)) {
                            scene = "menu";
                            backButton.color = color(0, 0, 255);
                        };
                    } else if(scene === "lose") {
                        if(retryButton.mouseIsInside(event)) {
                            score = 0;
                            seconds = 0;
                            player.x = width/2;
                            player.y = height - 40;
                            for(var i = 0; i < redBlocks.length; i++) {
                                redBlocks[i].x = width/2;
                                redBlocks[i].y = height/2;
                                redBlocks[i].xMoveRate = rangedRandom(redBlockXMoveRate.min, redBlockXMoveRate.max);
                                redBlocks[i].yMoveRate = rangedRandom(redBlockYMoveRate.min, redBlockYMoveRate.max);
                            };
                            startMainTheme();
                            scene = "play";
                            retryButton.color = color(0, 0, 255);
                        } else if(backButtonFromLoseScreen.mouseIsInside(event)) {
                            score = 0;
                            seconds = 0;
                            if(level != 0) {
                                level = 0;
                            };
                            numberOfBlocks = initialNumberOfBlocks;

                            player.x = width/2;
                            player.y = height-40;
                            redBlocks = [];

                            redBlockXMoveRate.min = -5; redBlockXMoveRate.max = 5;
                            redBlockYMoveRate.min = -5; redBlockYMoveRate.max = 5;
                            for(var i = 0; i < numberOfBlocks; i++) {
                                redBlocks.push(new Vector(width/2, height/2, rangedRandom(redBlockXMoveRate.min, redBlockXMoveRate.max), rangedRandom(redBlockYMoveRate.min, redBlockYMoveRate.max)));
                            };
                            backButtonFromLoseScreen.color = color(0, 0, 255);
                            scene = "menu";
                        } else if(nextButton.mouseIsInside(event) && level != 0 && level < 9 && score >= levels[level - 1].coinGoal) {
                            nextButton.color = color(0, 0, 255)
                            startMainTheme();
                            changeLevel(level + 1);
                        }
                    } else if (scene === "gameControls") {
                        if(backButton.mouseIsInside(event)) {
                            scene = "menu";
                            backButton.color = color(0, 0, 255);
                        } else if (skinsButton.mouseIsInside(event)) {
                            scene = "skins";
                            skinsButton.color = color(0, 0, 255);
                        } else if(soundsButton.mouseIsInside(event)) {
                            if(soundsOn === false) {
                                soundsOn = true;
                                localStorage.setItem("soundsOn", "true");
                                soundsButton.txt = "  Sounds : On  ";
                            } else if (soundsOn === true) {
                                soundsOn = false;
                                localStorage.setItem("soundsOn", "false");
                                soundsButton.txt = "  Sounds : Off  ";
                            };
                            soundsButton.color = color(0, 0, 255);
                        } else if(musicButton.mouseIsInside(event)) {
                            if(musicOn === false) {
                                musicOn = true;
                                localStorage.setItem("musicOn", "true");
                                musicButton.txt = "  Music : On  ";
                            } else if(musicOn === true) {
                                musicOn = false;
                                localStorage.setItem("musicOn", "false");
                                musicButton.txt = "  Music : Off  ";
                            };
                            musicButton.color = color(0, 0, 255);
                        };
                    }  else if(scene === "levels") {
                        if(backButton.mouseIsInside(event)) {
                            scene = "menu";
                            backButton.color = color(0, 0, 255);
                        };
                        for(i = 0; i < levelButtons.length; i++) {
                            if(levelButtons[i].mouseIsInside(event)) {
                                changeLevel(Number(levelButtons[i].txt));
                                levelButtons[i].color = color(0, 0, 255);
                                startMainTheme();
                            };
                        };

                    } else if(scene === "skins") {
                        if (backButton.mouseIsInside(event)) {
                            scene = "menu";
                            backButton.color = color(0, 0, 255)
                        } else if (blueSkin.mouseIsInside(event)) {
                            skin = "blue";
                            blueSkin.color = color(0, 0, 255)
                        } else if (greenSkin.mouseIsInside(event)) {
                            greenSkin.color = color(0, 255, 0);
                            skin = "green";
                        } else if (purpleSkin.mouseIsInside(event)) {
                            skin = "purple";
                            purpleSkin.color = color(111, 0, 255);
                        } else if (orangeSkin.mouseIsInside(event)) {
                            skin = "orange";
                            orangeSkin.color = color(180, 120, 0);
                        } else if (pinkSkin.mouseIsInside(event)) {
                            skin = "pink";
                            pinkSkin.color = color(255, 166, 201);
                        } else if(whiteSkin.mouseIsInside(event)) {
                          skin = "white";
                          whiteSkin.color = color(255, 255, 255)
                        } else if(event.clientX >= mercobaCharacterX && event.clientY >= mercobaCharacterY && event.clientX <= mercobaCharacterX + skinsButtonsWidthHeight && event.clientY <= mercobaCharacterY + skinsButtonsWidthHeight) {
                          skin = "mercoba";
                        }
                    };
            });



            // Handling key presses
            document.addEventListener("keydown", function(event) {
                keysPressed[event.keyCode] = true;
                if (event.keyCode === 39 || event.keyCode === 37 || event.keyCode === 38 || event.keyCode === 40 || event.keyCode === 82 || event.keyCode === 83 || event.keyCode === 87 || event.keyCode === 65 || event.keyCode === 68 || event.keyCode === 32 || event.key === " ") {
                    event.preventDefault();
                };
            });
            document.addEventListener("keyup", function(event) {
                keysPressed[event.keyCode] = false;
                if(pause === false && scene === "play") {
                    if(event.key === " " || event.keyCode === 32) {
                        pause = true;
                    };
                } else if(pause === true) {
                    if(event.key === " " || event.keyCode === 32) {
                        pause = false;
                    };
                };
            });

            // Resizing appropriately for resizing windows
            window.addEventListener("resize", function(event) {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
                width = canvas.width;
                height = canvas.height;

                initialNumberOfBlocks = Math.round(canvas.width/100 / 2);
                if(level === 0) {
                    numberOfBlocks = initialNumberOfBlocks;
                } else {
                    numberOfBlocks = initialNumberOfBlocks * levels[level - 1].nBlocks;
                };

                redBlocks = [];
                for(var i = 0; i < numberOfBlocks; i++) {
                    redBlocks.push(new Vector(width/2, height/2, rangedRandom(redBlockXMoveRate.min, redBlockXMoveRate.max), rangedRandom(redBlockYMoveRate.min, redBlockYMoveRate.max)));
                };


                for(i = 0; i < levelButtons.length; i++) {
                    // Adjusting the x position of the buttons on window resize
                    if(i === 0 || i === 3 || i === 6) { // for level buttons 1, 4, and 7
                        levelButtons[i].x = width / 2 - 70;
                    } else if(i === 1 || i === 4 || i === 7) { // for level buttons 2, 5, 8
                        levelButtons[i].x = width / 2;
                    } else if(i === 2 || i === 5 || i === 8) { // level buttons 3, 6, 9
                        levelButtons[i].x = width/ 2 + 70;
                    };
                    // Adjusting the y position of the level buttons on window resize
                    if(i < 3) { // for level buttons 1, 2, 3
                        levelButtons[i].y = height / 2 - 70;
                    } else if(i >= 3 && i < 6) { // for level buttons 4, 5, 6
                        levelButtons[i].y = height / 2;
                    } else if(i >= 6 && i < 9) { // for level buttons 7, 8, 9
                        levelButtons[i].y = height / 2 + 70;
                    };
                };


                playButton.x = width/2; playButton.y = height/2 - 110;
                howButton.x = width/2; howButton.y = height/2 + 90;
                levelsButton.x = width/2; levelsButton.y = height/2 - 10;
                gameControlsButton.x = width/2; gameControlsButton.y = height/2 + 190;
                backButton.x = 60; backButton.y = height - 50;
                retryButton.x = 60; retryButton.y = height - 125;
                backButtonFromLoseScreen.x = 60; backButtonFromLoseScreen.y = height - 50;
                nextButton.x = 60; nextButton.y = height - 200;

                soundsButton.x = width/2; soundsButton.y = height/2 - 100;
                musicButton.x = width/2; musicButton.y = height/2;
                skinsButton.x = width/2; skinsButton.y = height/2 + 100;
                blueSkin.x = width/2 - (width/5); blueSkin.y = height/2;
                blueSkin.width = height/5; blueSkin.height = height/5;
                greenSkin.x = width/2; greenSkin.y = height/2;
                greenSkin.width = height/5; greenSkin.height = height/5;
                purpleSkin.x = width/2 + (width/5); purpleSkin.y = height/2;
                purpleSkin.width = height/5; purpleSkin.height = height/5;


                coin.x = rangedRandom(20, width - 20);
                coin.y = rangedRandom(20, height - 20);
                player.x = width/2;
                player.y = height - 40;
            });
        </script>
    </body>
</html>
